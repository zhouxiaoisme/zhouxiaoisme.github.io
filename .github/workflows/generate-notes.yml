name: è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å­ç›®å½•ç¬”è®°åˆ—è¡¨
on:
  push:
    paths:
      - '**/*.html'  # ç›‘å¬ä»“åº“ä¸­æ‰€æœ‰HTMLæ–‡ä»¶çš„å˜åŒ–ï¼ˆä»»æ„ç›®å½•ï¼‰
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼Œè§£å†³é…ç½®å¤ç”¨é—®é¢˜
jobs:
  generate-notes:
    runs-on: ubuntu-latest
    steps:
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: è‡ªåŠ¨æ‰«æå¹¶ç”Ÿæˆæ‰€æœ‰å­ç›®å½•ç¬”è®°åˆ—è¡¨
        run: |
          # å®šä¹‰éœ€è¦æ’é™¤çš„ç›®å½•ï¼ˆç³»ç»Ÿç›®å½•/éè¯¾ç¨‹ç›®å½•ï¼‰
          EXCLUDE_DIRS=(".github" "node_modules" "assets" "images" ".git")
          
          # è·å–ä»“åº“æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼ˆä»…ä¸€çº§ç›®å½•ï¼‰
          ALL_DIRS=$(find . -maxdepth 1 -type d | sed 's|^\./||' | grep -v '^\.$')
          
          # éå†æ‰€æœ‰ç›®å½•ï¼Œè¿‡æ»¤æ‰æ’é™¤é¡¹
          for dir in $ALL_DIRS; do
            # è·³è¿‡æ’é™¤ç›®å½•
            if [[ " ${EXCLUDE_DIRS[@]} " =~ " $dir " ]]; then
              echo "è·³è¿‡æ’é™¤ç›®å½•ï¼š$dir"
              continue
            fi
            
            echo "å¼€å§‹å¤„ç†ç›®å½•ï¼š$dir"
            
            # è¿›å…¥å½“å‰ç›®å½•
            cd "$dir"
            
            # ä¸ºç›®å½•ç”Ÿæˆä¸ªæ€§åŒ–é…ç½®ï¼ˆè‡ªåŠ¨ä»ç›®å½•åæå–æ ‡é¢˜ï¼‰
            # ç›®å½•åè½¬æ ‡é¢˜ï¼šå»æ‰Courseåç¼€ + é¦–å­—æ¯å¤§å†™ + è¡¥å……æè¿°
            DIR_NAME_CLEAN=$(echo "$dir" | sed 's/Course//g')
            PAGE_TITLE=$(echo "$DIR_NAME_CLEAN" | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)} 1')å­¦ä¹ ç¬”è®°
            SUB_TITLE="ä»åº•å±‚é€»è¾‘æ‹†è§£$PAGE_TITLEï¼Œè¾ƒçœŸæ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹"
            
            # ä¸ºä¸åŒç›®å½•åŒ¹é…ä¸ªæ€§åŒ–å›¾æ ‡
            case $DIR_NAME_CLEAN in
              "python") AVATAR_EMOJI="ğŸ" ;;
              "ai") AVATAR_EMOJI="ğŸ¤–" ;;
              "aigc") AVATAR_EMOJI="ğŸ¨" ;;
              "java") AVATAR_EMOJI="â˜•" ;;
              "web") AVATAR_EMOJI="ğŸŒ" ;;
              *) AVATAR_EMOJI="ğŸ“š" ;; # é»˜è®¤å›¾æ ‡
            esac
            
            # ç”Ÿæˆç¬”è®°åˆ—è¡¨HTMLæ–‡ä»¶ï¼ˆç»Ÿä¸€å‘½åä¸ºnotes.htmlï¼‰
            echo "<!DOCTYPE html>
            <html lang='zh-CN'>
            <head>
                <meta charset='UTF-8'>
                <meta name='viewport' content='width=device-width, initial-scale=1.0'>
                <title>$PAGE_TITLE | ä¸€ä¸ªæ™®é€šçš„æ€è€ƒè€…</title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                        font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
                        transition: all 0.3s ease;
                    }
                    body {
                        background: linear-gradient(120deg, #f5f7fa 0%, #e4eaf5 100%);
                        color: #333;
                        line-height: 1.5;
                        padding: 20px;
                        max-width: 1000px;
                        margin: 0 auto;
                        min-height: 100vh;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                    }
                    .container {
                        background: rgba(255, 255, 255, 0.95);
                        border-radius: 16px;
                        padding: 40px 60px;
                        box-shadow: 0 8px 24px rgba(149, 157, 165, 0.15);
                        border: 1px solid #e8f4f8;
                    }
                    .header {
                        text-align: center;
                        margin-bottom: 35px;
                    }
                    .avatar {
                        width: 120px;
                        height: 120px;
                        border-radius: 50%;
                        background: linear-gradient(45deg, #4299e1 0%, #38b2ac 100%);
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 48px;
                        color: white;
                        box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
                    }
                    .avatar:hover {
                        transform: scale(1.05);
                        box-shadow: 0 6px 18px rgba(66, 153, 225, 0.4);
                    }
                    h1 {
                        font-size: 32px;
                        margin-bottom: 8px;
                        background: linear-gradient(90deg, #2d3748, #4a5568);
                        -webkit-background-clip: text;
                        background-clip: text;
                        color: transparent;
                        font-weight: 600;
                    }
                    .subtitle {
                        color: #718096;
                        font-size: 17px;
                        font-weight: 400;
                        font-style: italic;
                    }
                    .notes-section h2 {
                        font-size: 22px;
                        margin-bottom: 15px;
                        background: linear-gradient(90deg, #4299e1, #9f7aea);
                        -webkit-background-clip: text;
                        background-clip: text;
                        color: transparent;
                        border-left: 4px solid #4299e1;
                        padding-left: 12px;
                        font-weight: 600;
                    }
                    .notes-list {
                        list-style: none;
                        display: grid;
                        gap: 12px;
                    }
                    .notes-list li {
                        background: linear-gradient(180deg, #f0f8fb 0%, #fef7fb 100%);
                        border-radius: 10px;
                        border: 1px solid #f5fafe;
                        box-shadow: 0 2px 8px rgba(224, 231, 255, 0.5);
                        transition: all 0.3s ease;
                    }
                    .notes-list li:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(224, 231, 255, 0.8);
                    }
                    .notes-list a {
                        display: flex;
                        align-items: center;
                        padding: 16px 20px;
                        color: #2d3748;
                        text-decoration: none;
                        font-size: 16px;
                    }
                    .notes-list a::before {
                        content: 'ğŸ“';
                        margin-right: 12px;
                        font-size: 18px;
                    }
                    .notes-list a:hover {
                        color: #4299e1;
                    }
                    .back-btn {
                        margin-top: 30px;
                        text-align: center;
                    }
                    .back-btn a {
                        display: inline-block;
                        padding: 10px 24px;
                        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        text-decoration: none;
                        border-radius: 8px;
                        font-size: 15px;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                    }
                    .back-btn a:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
                    }
                    .footer {
                        text-align: center;
                        margin-top: 25px;
                        background: linear-gradient(90deg, #718096, #a0aec0);
                        -webkit-background-clip: text;
                        background-clip: text;
                        color: transparent;
                        font-size: 14px;
                        padding-bottom: 10px;
                    }
                    @media (max-width: 768px) {
                        body {
                            max-width: 100%;
                            padding: 15px;
                        }
                        .container {
                            padding: 30px 20px;
                        }
                        .avatar {
                            width: 100px;
                            height: 100px;
                            font-size: 40px;
                        }
                        h1 {
                            font-size: 28px;
                        }
                        .notes-section h2 {
                            font-size: 20px;
                        }
                        .notes-list a {
                            padding: 14px 16px;
                            font-size: 15px;
                        }
                    }
                </style>
            </head>
            <body>
                <div class='container'>
                    <div class='header'>
                        <div class='avatar'>$AVATAR_EMOJI</div>
                        <h1>$PAGE_TITLE</h1>
                        <p class='subtitle'>$SUB_TITLE</p>
                    </div>
                    <div class='notes-section'>
                        <h2>æˆ‘çš„ç¬”è®°åˆ—è¡¨</h2>
                        <ul class='notes-list'>" > notes.html
            
            # éå†å½“å‰ç›®å½•ä¸‹çš„HTMLæ–‡ä»¶ï¼Œæ’é™¤ç”Ÿæˆçš„notes.html
            for file in *.html; do
              if [ "$file" != "notes.html" ]; then
                # æ ¼å¼åŒ–æ–‡ä»¶åä½œä¸ºæ ‡é¢˜ï¼ˆå»æ‰åç¼€ã€æ›¿æ¢è¿å­—ç¬¦/ä¸‹åˆ’çº¿ä¸ºç©ºæ ¼ã€é¦–å­—æ¯å¤§å†™ï¼‰
                title=$(echo "$file" | sed 's/\.html//g; s/-/ /g; s/_/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)} 1')
                echo "                            <li><a href='$file'>$title</a></li>" >> notes.html
              fi
            done
            
            # è¡¥å……HTMLå°¾éƒ¨å†…å®¹
            echo "                        </ul>
                    </div>
                    <div class='back-btn'>
                        <a href='../index.html'>â† è¿”å›ä¸ªäººä¸»é¡µ</a>
                    </div>
                </div>
                <div class='footer'>
                    <p>ä¸€ä¸ªçˆ±æ€è€ƒã€çˆ±è¾ƒçœŸã€çˆ±ç¡è§‰çš„æ™®é€šäºº Â© 2025</p>
                </div>
            </body>
            </html>" >> notes.html
            
            # è¿”å›ä¸Šçº§ç›®å½•ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªç›®å½•
            cd ..
          done
      
      - name: æäº¤å¹¶æ¨é€æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶
        run: |
          # é…ç½®Gitèº«ä»½
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          # æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¼ºåˆ¶è¦†ç›–æœ¬åœ°ï¼Œé¿å…å†²çªï¼‰
          git fetch --all
          git reset --hard origin/main
          # æ·»åŠ æ‰€æœ‰å­ç›®å½•ä¸‹çš„notes.htmlï¼ˆæ’é™¤ç³»ç»Ÿç›®å½•ï¼‰
          git add $(find . -maxdepth 2 -name "notes.html" | grep -vE "\.github|\.git|node_modules")
          # æäº¤ï¼ˆæ— å˜æ›´æ—¶ä¸æŠ¥é”™ï¼‰
          git commit -m "è‡ªåŠ¨æ›´æ–°æ‰€æœ‰å­ç›®å½•ç¬”è®°åˆ—è¡¨" || echo "æ— æ–‡ä»¶éœ€è¦æäº¤"
          # å¼ºåˆ¶æ¨é€ï¼ˆè§£å†³åˆ†æ”¯ä¸åŒæ­¥é—®é¢˜ï¼‰
          git push origin main --force
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
